(global["webpackChunkuniapp_cocokele"]=global["webpackChunkuniapp_cocokele"]||[]).push([["pages/demo/index"],{1830:function(){},7739:function(t,e,a){"use strict";a(923);var n,i,s=function(){var t=this,e=t.$createElement;t._self._c},o=[],h=a(6480)["default"],c=function(){a.e("pages/demo/components/signature").then(function(){return resolve(a(7723))}.bind(null,a))["catch"](a.oe)},g={components:{signatureComponent:c},data:function(){return{title:"Hello",imgs:["https://oxy-1258558723.cos.ap-shanghai.myqcloud.com/temp/monihetong1.jpeg","https://oxy-1258558723.cos.ap-shanghai.myqcloud.com/temp/monihetong2.jpeg","https://oxy-1258558723.cos.ap-shanghai.myqcloud.com/temp/monihetong3.jpeg","https://oxy-1258558723.cos.ap-shanghai.myqcloud.com/temp/monihetong4.jpeg"],currentPage:1,totalPages:0,ctx:null,canvasWidth:300,canvasHeight:500,imagesPerPage:1,loadedImages:[],showSignatureModal:!1,isSigned:!1,signaturePath:"",signatureX:0,signatureY:0,signatureWidth:120,signatureHeight:60,showAnimation:!1}},computed:{canvasStyle:function(){return{width:"".concat(this.canvasWidth,"px"),height:"".concat(this.canvasHeight,"px"),border:"1px solid #ddd",backgroundColor:"#f5f5f5"}}},onLoad:function(){this.totalPages=Math.ceil(this.imgs.length/this.imagesPerPage),console.log("onLoad: 总页数计算为",this.totalPages)},onReady:function(){console.log("onReady: 开始初始化画布"),this.initCanvas()},methods:{initCanvas:function(){try{var t=h.getWindowInfo(),e=t.windowWidth;this.canvasWidth=e-40,this.canvasHeight=1.415*this.canvasWidth,console.log("initCanvas: 窗口信息",t),console.log("initCanvas: 画布尺寸设置为",this.canvasWidth,"×",this.canvasHeight)}catch(a){console.error("获取系统信息失败:",a),this.canvasWidth=300,this.canvasHeight=425,console.log("initCanvas: 使用默认画布尺寸",this.canvasWidth,"×",this.canvasHeight)}this.ctx=h.createCanvasContext("pdfCanvas"),console.log("initCanvas: 成功获取canvas上下文"),this.loadImages()},loadImages:function(){this.loadedImages=[];var t=0,e=this;if(console.log("loadImages: 开始加载图片，总数",this.imgs.length),0===this.imgs.length)return console.log("loadImages: 没有图片需要加载"),void this.drawCurrentPage();this.imgs.forEach(function(a,n){console.log("遍历获取图片地址",a),h.getImageInfo({src:a,success:function(a){console.log("图片加载成功:",a),e.loadedImages[n]=a,t++,console.log("loadedCount",t),console.log("this.imgs.length",e.imgs.length),t===e.imgs.length&&(console.log("所有图片Loaded完毕,开始加载当前渲染第一页"),e.drawCurrentPage())},fail:function(i){console.error("图片加载失败: ".concat(a),i),e.loadedImages[n]={width:1240,height:1755,type:"jpeg",path:""},t++,t===e.imgs.length&&(console.log("所有图片处理完毕(包含失败),开始渲染页面"),e.drawCurrentPage())}})})},drawCurrentPage:function(){if(this.ctx){console.log("drawCurrentPage: 开始绘制页面",this.currentPage),console.log("drawCurrentPage: 当前画布尺寸",this.canvasWidth,"×",this.canvasHeight),this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.setFillStyle("#f5f5f5"),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight);var t=this.currentPage-1,e=this.loadedImages[t];if(e&&e.path){console.log("drawCurrentPage: 准备绘制图片",t,"信息:",e);var a,n,i=e.width/e.height,s=this.canvasWidth-40,o=this.canvasHeight-40;s/o>i?(n=o,a=n*i):(a=s,n=a/i);var h=(this.canvasWidth-a)/2,c=(this.canvasHeight-n)/2;console.log("drawCurrentPage: 图片绘制参数",h,c,a,n),this.ctx.drawImage(e.path,h,c,a,n),this.currentPage===this.totalPages&&this.signaturePath&&this.ctx.drawImage(this.signaturePath,this.signatureX,this.signatureY,this.signatureWidth,this.signatureHeight)}else console.log("drawCurrentPage: 图片加载失败，绘制占位符"),this.ctx.setFillStyle("#cccccc"),this.ctx.fillRect(20,20,this.canvasWidth-40,this.canvasHeight-40),this.ctx.setFillStyle("#666666"),this.ctx.setFontSize(14),this.ctx.setTextAlign("center"),this.ctx.fillText("图片加载失败",this.canvasWidth/2,this.canvasHeight/2);this.ctx.draw(!1)}else console.log("没有canvas 实例 直接打回")},prevPage:function(){this.currentPage>1&&(this.currentPage--,this.drawCurrentPage())},nextPage:function(){this.currentPage<this.totalPages&&(this.currentPage++,this.drawCurrentPage())},openSignatureModal:function(){var t=this;this.showSignatureModal=!0,this.showAnimation=!0,setTimeout(function(){t.showAnimation=!1},500)},closeSignatureModal:function(){this.showSignatureModal=!1},handleSignatureComplete:function(t){var e=this;console.log("触发父组件回调 ==== >",t),this.signaturePath=t,this.isSigned=!0,this.showSignatureModal=!1,console.log("this.showSignatureModal",this.showSignatureModal),h.getImageInfo({src:t,success:function(t){var a=t.width/t.height;e.signatureWidth=120,e.signatureHeight=120/a,e.signatureX=(e.canvasWidth-e.signatureWidth)/2,e.signatureY=(e.canvasHeight-e.signatureHeight)/2,e.drawCurrentPage()},fail:function(t){console.error("获取签名图片信息失败:",t),e.signatureX=(e.canvasWidth-e.signatureWidth)/2,e.signatureY=(e.canvasHeight-e.signatureHeight)/2,e.drawCurrentPage()}}),h.showToast({title:"签名已添加",icon:"success",duration:1500})},confirmSignature:function(){var t=this;h.showModal({title:"确认签署",content:"确定要确认签署吗？",success:function(e){e.confirm&&t.openPDF()}})},openPDF:function(){h.canvasToTempFilePath({canvasId:"pdfCanvas",destWidth:2*this.canvasWidth,destHeight:2*this.canvasHeight,success:function(t){console.log("生成的临时图片路径:",t.tempFilePath),h.showToast({title:"协议确认成功",icon:"success"})},fail:function(t){console.error("生成图片失败:",t),h.showToast({title:"操作失败",icon:"none"})}})}}},r=g,l=a(1830),u=a.n(l),d=(u(),a(8535)),v=(0,d["default"])(r,s,o,!1,null,"2ed83a12",null,!1,n,i),m=v.exports,f=a(1372)["default"],p=a(6480)["createPage"];f.__webpack_require_UNI_MP_PLUGIN__=a,p(m)}},function(t){var e=function(e){return t(t.s=e)};t.O(0,["common/vendor"],function(){return e(7739)});t.O()}]);